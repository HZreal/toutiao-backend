# **数据库设计**

一般不用业务数据为主键，

外键仅是保持数据的完整性，当主表主键发生变化时，从表外键字段会进行检查一致性，是否同步删除、设为空还是不作处理，这是需要额外开销的，因此项目规模大了就删除外键以提高性能，至于外键一致性的问题额外编写sql修整

动态数量变化的业务数据尽量不作为字段(字段增加造成难维护、浪费数据库空间)，建新表

部分业务数据可查表(如文章的评论数、用户页的关注数、粉丝数、点赞数)获取，但依然给文章表增加评论数这个字段，
这是为了前端响应速度以及减少数据库查询次数，即用空间换时间，反范氏设计

文章涉及到是否删除、未审核、审核中、发布等状态，整合到一个字段status

文章封面图片可以额外建表，但为了响应速度以及减少查询，设计为文章表的一个字段，类型为JSON保存图片数量、url等信息

评论表涉及到对评论继续评论，故为自关联表，关联字段parent_id=null即表示对文章的评论

用户对文章/评论的态度(喜欢/不喜欢)可以整合在一张表，用一个type字段区分是对文章还是评论

用户关注表/粉丝表互为逆关系，故整合到一张表，查询时参数反向查询即可

### 整型类型说明：
创建数据库字段sql语句

    CREATE TABLE `test` (
        `id` int(10) unsigned NOT NULL AUTO_INCREMENT,
        `i1` int(3) unsigned zerofill DEFAULT NULL,
        `i2` int(6) unsigned zerofill DEFAULT NULL,
        PRIMARY KEY (`id`)
    ) ENGINE=MyISAM DEFAULT CHARSET=utf8

无论是int(3), int(6), 都可以显示6位以上的整数。但是，当数字不足3位或6位时，前面会用0补齐

### char 与 varchar 的选择：

char 不可变，查询效率高(对应位置直接比较)，可能造成存储浪费，如手机号采用

varchar 可变，查询效率不如char(只能逐个比较)，节省空间，如用户名采用

### 字段是否允许为空、是否有默认值

主键、用户名等不允许为空

文章状态设默认值，添加文章时不需要指定此字段

### 索引

默认的查询按顺序查，效率不高

建立索引会以某种规则(数据结构如tree)创建索引文件，提高查询效率，有时增加冗余字段(空间换时间的反范式设计)

但是减缓了增删改的速度，且创建索引文件有开销








